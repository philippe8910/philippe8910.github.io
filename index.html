<!DOCTYPE html>
<html>

<head>
  <title>Happy~~</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>

  <style>
    .a-enter-vr-button {
      display: none !important;
    }
    #log {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      max-height: 150px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-size: 12px;
      padding: 5px;
      box-sizing: border-box;
      z-index: 9999;
    }
  </style>
</head>

<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="trackingMethod: best; sourceType: webcam;">
    <a-assets>
      <img id="image1" src="assets/Image/Forward.jpg" />
      <img id="image2" src="assets/Image/Back.jpg" />
      <audio id="audio1" src="assets/Audio/music.mp3" crossorigin="anonymous"></audio>
      <audio id="audio2" src="assets/Audio/music.mp3" crossorigin="anonymous"></audio>
    </a-assets>

    <!-- First NFT marker -->
    <a-nft type="nft" url="assets/Track/NTD/100-1" smooth="true" smoothCount="30" smoothTolerance="0.01" smoothThreshold="5">
      <a-plane id="detected-image1" src="#image1" position="60 60 -60" rotation="-90 0 0" width="180" height="300"></a-plane>
    </a-nft>

    <!-- Second NFT marker -->
    <a-nft type="nft" url="assets/Track/USD/100-1" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
      <a-plane id="detected-image2" src="#image2" position="60 60 -60" rotation="-90 0 0" width="180" height="300"></a-plane>
    </a-nft>

    <a-entity camera></a-entity>
  </a-scene>

  <div id="log"></div>

  <script>
    function logMessage(message) {
      var logDiv = document.getElementById('log');
      logDiv.innerHTML += message + '<br>';
      console.log(message);
    }

    document.addEventListener('DOMContentLoaded', function () {
      AFRAME.registerComponent('play-audio-on-detect', {
        schema: { type: 'selector' },
        init: function () {
          var audio = this.data;
          var playing = false;

          var playAudio = function() {
            logMessage('Attempting to play audio.');
            if (audio && !playing) {
              audio.play().then(() => {
                logMessage('Audio playing.');
                playing = true;
              }).catch((error) => {
                logMessage('Audio play failed: ' + error);
              });
            }
          };

          this.el.addEventListener('markerFound', function () {
            logMessage('Marker found, playing audio.');
            playAudio();
          });

          this.el.addEventListener('arjs-nft-loaded', function () {
            logMessage('NFT loaded, playing audio.');
            playAudio();
          });

          this.el.addEventListener('arjs-nft-loaded', function () {
            logMessage('NFT loaded, playing audio.');
            playAudio();
          });
        }
      });

      var nft1 = document.querySelector('a-nft[url="assets/Track/NTD/100-1"]');
      var nft2 = document.querySelector('a-nft[url="assets/Track/USD/100-1"]');

      if (nft1) {
        nft1.setAttribute('play-audio-on-detect', '#audio1');
        logMessage('Component attached to NFT1');
      } else {
        logMessage('NFT1 not found');
      }

      if (nft2) {
        nft2.setAttribute('play-audio-on-detect', '#audio2');
        logMessage('Component attached to NFT2');
      } else {
        logMessage('NFT2 not found');
      }
    });

    // Additional logging to check if assets and elements are loaded
    window.onload = function() {
      logMessage('Window loaded, checking assets...');
      var audio1 = document.getElementById('audio1');
      var audio2 = document.getElementById('audio2');
      if (audio1) {
        logMessage('Audio1 loaded: ' + audio1.src);
      } else {
        logMessage('Audio1 not found');
      }
      if (audio2) {
        logMessage('Audio2 loaded: ' + audio2.src);
      } else {
        logMessage('Audio2 not found');
      }
      var image1 = document.getElementById('image1');
      var image2 = document.getElementById('image2');
      if (image1) {
        logMessage('Image1 loaded: ' + image1.src);
      } else {
        logMessage('Image1 not found');
      }
      if (image2) {
        logMessage('Image2 loaded: ' + image2.src);
      } else {
        logMessage('Image2 not found');
      }
    };
  </script>
</body>

</html>
